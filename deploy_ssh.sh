#!/bin/bash
# -*- coding: utf-8 -*-

"""
Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ñ€Ð°Ð·Ð²ÐµÑ€Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹ Ð¡ÐšÐ£Ð” Ð½Ð° SSH ÑÐµÑ€Ð²ÐµÑ€Ðµ
"""

echo "ðŸš€ Ð ÐÐ—Ð’Ð•Ð Ð¢Ð«Ð’ÐÐÐ˜Ð• Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐ« Ð¡ÐšÐ£Ð” ÐÐ SSH Ð¡Ð•Ð Ð’Ð•Ð Ð•"
echo "============================================="

# Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ÑÑ‚Ð¸ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹
check_command() {
    if [ $? -eq 0 ]; then
        echo "âœ… $1"
    else
        echo "âŒ $1"
        exit 1
    fi
}

# 1. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ð¾Ð¹ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹
echo ""
echo "ðŸ” ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹..."
uname -a
check_command "Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ ÑÐ¸ÑÑ‚ÐµÐ¼Ðµ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð°"

# 2. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Python
echo ""
echo "ðŸ ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Python..."
python3 --version
check_command "Python ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½"

# 3. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° pip
pip3 --version
check_command "pip ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½"

# 4. Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ€Ð°Ð±Ð¾Ñ‡ÐµÐ¹ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¸
echo ""
echo "ðŸ“ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ€Ð°Ð±Ð¾Ñ‡ÐµÐ¹ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¸..."
mkdir -p ~/skud_system
cd ~/skud_system
check_command "Ð Ð°Ð±Ð¾Ñ‡Ð°Ñ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð°"

# 5. Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð²Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ
echo ""
echo "ðŸ”§ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð²Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ..."
python3 -m venv venv
check_command "Ð’Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ðµ ÑÐ¾Ð·Ð´Ð°Ð½Ð¾"

# 6. ÐÐºÑ‚Ð¸Ð²Ð°Ñ†Ð¸Ñ Ð²Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ
echo ""
echo "âš¡ ÐÐºÑ‚Ð¸Ð²Ð°Ñ†Ð¸Ñ Ð²Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ..."
source venv/bin/activate
check_command "Ð’Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ðµ Ð°ÐºÑ‚Ð¸Ð²Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾"

# 7. Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹ Ð¿Ð°Ð¿Ð¾Ðº
echo ""
echo "ðŸ“‚ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹ Ð¿Ð°Ð¿Ð¾Ðº..."
mkdir -p real_data_input
mkdir -p backups
mkdir -p logs
mkdir -p src
check_command "Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð¿Ð°Ð¿Ð¾Ðº ÑÐ¾Ð·Ð´Ð°Ð½Ð°"

# 8. Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ„Ð°Ð¹Ð»Ð° requirements.txt
echo ""
echo "ðŸ“‹ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ requirements.txt..."
cat > requirements.txt << EOF
# Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ð´Ð»Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹ Ð¡ÐšÐ£Ð”
configparser
pathlib2
EOF
check_command "requirements.txt ÑÐ¾Ð·Ð´Ð°Ð½"

# 9. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
echo ""
echo "ðŸ“¦ Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹..."
pip install -r requirements.txt
check_command "Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹"

# 10. Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ð¾Ð³Ð¾ Ñ„Ð°Ð¹Ð»Ð°
echo ""
echo "âš™ï¸ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸..."
cat > real_skud_config.ini << 'EOF'
[MONITORING]
watch_directory = real_data_input
check_interval = 30
backup_enabled = true
max_backup_files = 10

[DATABASE]
db_file = real_skud_data.db
wal_mode = true
optimize_on_startup = true

[FILTERING]
exclude_employees = ÐžÑ…Ñ€Ð°Ð½Ð° Ðœ., 1 Ð¿Ð¾ÑÑ‚ Ð¾., 2 Ð¿Ð¾ÑÑ‚ Ð¾., ÐšÑ€Ñ‹ÑˆÐ° Ðš.
exclude_doors = Ð²Ñ‹Ñ…Ð¾Ð´ Ð¿Ð°Ñ€ÐºÐ¸Ð½Ð³, 1ÑÑ‚ ÑÐµÑ€Ð²ÐµÑ€Ð½Ð°Ñ, Ð¡Ñ‚ÑƒÐ´Ð¸Ñ - Ð²Ð½.Ð¼Ð¸Ñ€, ÐŸÐ°Ñ€ÐºÐ¸Ð½Ð³ - Ð»Ð¸Ñ„Ñ‚.Ñ…Ð¾Ð»Ð», 2 Ð»ÑÑ‚ - Ð²Ð½ÐµÑˆÐ½.Ð¼Ð¸Ñ€

[LOGGING]
level = INFO
log_to_file = true
log_file = logs/skud_system.log
EOF
check_command "ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð°"

echo ""
echo "ðŸŽ‰ Ð‘ÐÐ—ÐžÐ’ÐÐ¯ ÐÐÐ¡Ð¢Ð ÐžÐ™ÐšÐ Ð—ÐÐ’Ð•Ð Ð¨Ð•ÐÐ!"
echo ""
echo "ðŸ“‹ Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ ÑˆÐ°Ð³Ð¸:"
echo "1. Ð¡ÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ñ„Ð°Ð¹Ð»Ñ‹ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€"
echo "2. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ Ð°Ð²Ñ‚Ð¾Ð·Ð°Ð¿ÑƒÑÐº Ñ‡ÐµÑ€ÐµÐ· systemd"
echo "3. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³"
echo ""
echo "ðŸ“ Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° ÑÐ¾Ð·Ð´Ð°Ð½Ð° Ð²: ~/skud_system/"